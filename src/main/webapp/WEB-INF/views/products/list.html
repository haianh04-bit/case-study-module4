<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/layout}">
<head>
    <title>Danh s√°ch s·∫£n ph·∫©m - Sport Shop</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"/>
</head>
<body>
<section layout:fragment="content">
    <div class="container mt-4">

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>üõí Danh s√°ch s·∫£n ph·∫©m</h2>
            <!-- ch·ªâ admin th·∫•y -->
            <a class="btn btn-success" th:href="@{/products/create}" sec:authorize="hasRole('ADMIN')">
                <i class="bi bi-plus-circle"></i> Th√™m s·∫£n ph·∫©m
            </a>
        </div>

        <!-- Form t√¨m ki·∫øm -->
        <form th:action="@{/products}" method="get" class="row g-2 mb-4">
            <div class="col-md-4">
                <input type="text" name="search" th:value="${search}" class="form-control"
                       placeholder="üîç T√¨m theo t√™n s·∫£n ph·∫©m"/>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100" type="submit"><i class="bi bi-search"></i> T√¨m</button>
            </div>
        </form>

        <!-- Danh s√°ch s·∫£n ph·∫©m d·∫°ng card -->
        <div class="row g-4">
            <div class="col-md-4" th:each="product : ${products}">
                <div class="card h-100 shadow-sm">
                    <img class="card-img-top" th:src="@{/resources/uploads/{url}(url=${product.imageUrl})}"
                         alt="·∫¢nh s·∫£n ph·∫©m" style="height: 200px; object-fit: cover;"/>

                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title" th:text="${product.name}"></h5>
                        <p class="card-text text-muted" th:text="${product.categoryName}"></p>
                        <p class="card-text fw-bold text-danger"
                           th:text="${#numbers.formatDecimal(product.price,0,'POINT',2,'COMMA')} + ' ‚Ç´'"></p>
                        <p class="card-text small text-truncate" th:text="${product.description}"></p>

                        <div class="mt-auto">
                            <!-- Ai ƒëƒÉng nh·∫≠p c≈©ng xem ƒë∆∞·ª£c -->
                            <a class="btn btn-outline-primary btn-sm"
                               th:href="@{/products/{id}(id=${product.id})}">
                                <i class="bi bi-eye"></i> Xem
                            </a>

                            <!-- Ch·ªâ USER th·∫•y -->
                            <a class="btn btn-danger btn-sm" href="#"
                               sec:authorize="hasRole('USER')">
                                <i class="bi bi-cart-plus-fill"></i> Mua ngay
                            </a>

                            <!-- Ch·ªâ ADMIN th·∫•y -->
                            <a class="btn btn-warning btn-sm"
                               th:href="@{/products/{id}/edit(id=${product.id})}"
                               sec:authorize="hasRole('ADMIN')">
                                <i class="bi bi-pencil-square"></i> S·ª≠a
                            </a>
                            <a class="btn btn-outline-danger btn-sm"
                               th:href="@{/products/{id}/delete(id=${product.id})}"
                               sec:authorize="hasRole('ADMIN')"
                               onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh√¥ng?')">
                                <i class="bi bi-trash"></i> X√≥a
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- N·∫øu kh√¥ng c√≥ s·∫£n ph·∫©m -->
        <div th:if="${products.totalElements == 0}" class="alert alert-warning text-center mt-4">
            ‚ö†Ô∏è Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o.
        </div>

        <!-- Ph√¢n trang -->
        <nav th:if="${products.totalPages > 1}" class="mt-4">
            <ul class="pagination justify-content-center">

                <!-- Previous -->
                <li class="page-item" th:classappend="${products.first}? 'disabled'">
                    <a class="page-link"
                       th:href="@{/products(page=${products.number - 1}, search=${search})}">¬´ Tr∆∞·ªõc</a>
                </li>

                <!-- Trang s·ªë -->
                <li class="page-item"
                    th:each="i : ${#numbers.sequence(0, products.totalPages - 1)}"
                    th:classappend="${products.number == i}? 'active'">
                    <a class="page-link"
                       th:href="@{/products(page=${i}, search=${search})}"
                       th:text="${i + 1}">1</a>
                </li>

                <!-- Next -->
                <li class="page-item" th:classappend="${products.last}? 'disabled'">
                    <a class="page-link"
                       th:href="@{/products(page=${products.number + 1}, search=${search})}">Sau ¬ª</a>
                </li>
            </ul>
        </nav>
    </div>
</section>
</body>
</html>
